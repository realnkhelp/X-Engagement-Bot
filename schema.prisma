generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           Int      @id @default(autoincrement())
  telegramId   BigInt   @unique @map("telegram_id")
  firstName    String?  @map("first_name")
  lastName     String?  @map("last_name")
  username     String?
  avatar       String?  @default("")
  balance      Decimal  @default(0.0000) @db.Decimal(10, 4)
  points       Decimal  @default(0.00) @db.Decimal(10, 2)
  twitterLink  String?  @map("twitter_link")
  isBlocked    Boolean  @default(false) @map("is_blocked")
  lastLogin    DateTime? @map("last_login")
  createdAt    DateTime @default(now()) @map("created_at")

  transactions Transaction[]
  tasks        UserTask[]
  reports      Report[]
  createdTasks Task[]

  @@map("users")
}

model Admin {
  id        Int       @id @default(autoincrement())
  name      String
  username  String    @unique
  password  String
  role      Role      @default(Moderator)
  status    Status    @default(Active)
  lastLogin DateTime? @map("last_login")
  createdAt DateTime  @default(now()) @map("created_at")

  logs      AdminLog[]

  @@map("admins")
}

enum Role {
  Super_Admin @map("Super Admin")
  Moderator
}

enum Status {
  Active
  Blocked
}

model Settings {
  id                 Int     @id @default(autoincrement())
  botName            String  @default("Task Bot") @map("bot_name")
  minWithdraw        Decimal @default(50.00) @map("min_withdraw") @db.Decimal(10, 2)
  onboardingBonus    Decimal @default(500.00) @map("onboarding_bonus") @db.Decimal(10, 2)
  pointCurrencyName  String  @default("Points") @map("point_currency_name")
  upiId              String? @default("") @map("upi_id")
  telegramChannel    String  @default("https://t.me/ads_tasker") @map("telegram_channel")
  maintenanceMode    Boolean @default(false) @map("maintenance_mode")
  maintenanceMessage String? @map("maintenance_message")
  maintenanceDate    String? @default("") @map("maintenance_date")

  @@map("settings")
}

model Asset {
  id     Int    @id @default(autoincrement())
  name   String
  symbol String
  logo   String

  @@map("assets")
}

model TaskRate {
  id       Int     @id @default(autoincrement())
  category String
  name     String
  price    Decimal @db.Decimal(10, 4)
  points   Int

  @@map("task_rates")
}

model Banner {
  id       Int    @id @default(autoincrement())
  imageUrl String @map("image_url")

  @@map("banners")
}

model SupportLink {
  id    Int    @id @default(autoincrement())
  title String
  url   String

  @@map("support_links")
}

model PaymentMethod {
  id        Int           @id @default(autoincrement())
  name      String
  minimum   String
  status    PaymentStatus @default(active)
  createdAt DateTime      @default(now()) @map("created_at")

  @@map("payment_methods")
}

enum PaymentStatus {
  active
  inactive
}

model Task {
  id             Int        @id @default(autoincrement())
  creatorId      BigInt?    @map("creator_id")
  title          String
  categoryId     String?    @default("Follow") @map("category_id")
  link           String
  quantity       Int
  completedCount Int        @default(0) @map("completed_count")
  reward         Decimal    @db.Decimal(10, 2)
  iconUrl        String?    @map("icon_url")
  status         TaskStatus @default(active)
  type           TaskType   @default(user)
  createdAt      DateTime   @default(now()) @map("created_at")

  creator        User?      @relation(fields: [creatorId], references: [telegramId])

  @@map("tasks")
}

enum TaskStatus {
  active
  inactive
}

enum TaskType {
  user
  admin
}

model UserTask {
  id        Int            @id @default(autoincrement())
  userId    Int            @map("user_id")
  taskId    Int            @map("task_id")
  status    UserTaskStatus @default(completed)
  claimedAt DateTime       @default(now()) @map("claimed_at")

  user User @relation(fields: [userId], references: [id])

  @@map("user_tasks")
}

enum UserTaskStatus {
  completed
  rejected
}

model Transaction {
  id        Int               @id @default(autoincrement())
  userId    Int               @map("user_id")
  amount    Decimal           @db.Decimal(10, 4)
  type      TransactionType
  status    TransactionStatus @default(Pending)
  method    String?
  txid      String?
  reason    String?
  createdAt DateTime          @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("transactions")
}

enum TransactionType {
  Deposit
  Task_Payment  @map("Task Payment")
  Task_Creation @map("Task Creation")
  Bonus
  Penalty
}

enum TransactionStatus {
  Completed
  Pending
  Rejected
}

model Report {
  id                 Int          @id @default(autoincrement())
  userId             Int          @map("user_id")
  cheaterUsername    String?      @map("cheater_username")
  taskLink           String?      @map("task_link")
  cheaterProfileLink String?      @map("cheater_profile_link")
  subject            String?      @default("Report")
  message            String?      @db.Text
  status             ReportStatus @default(pending)
  reason             String?
  createdAt          DateTime     @default(now()) @map("created_at")

  reporter User @relation(fields: [userId], references: [id])

  @@map("reports")
}

enum ReportStatus {
  pending
  resolved
  rejected
}

model Announcement {
  id        Int      @id @default(autoincrement())
  title     String
  message   String   @db.Text
  category  String?  @default("update")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("announcements")
}

model Rule {
  id           Int     @id @default(autoincrement())
  title        String
  description  String  @db.Text
  icon         String?
  displayOrder Int?    @default(0) @map("display_order")

  @@map("rules")
}

model AdminLog {
  id        Int      @id @default(autoincrement())
  adminId   Int?     @map("admin_id")
  action    String
  target    String?
  details   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  admin Admin? @relation(fields: [adminId], references: [id])

  @@map("activity_logs")
}
